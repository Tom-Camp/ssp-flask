{% extends "project/project_base.html" %}

{% block title %}{{ project.name }}{% endblock %}

{% block breadcrumbs %}
<ul>
    <li><a href="/">Home</a></li>
    <li><a href="{{ url_for("project.project_list_page") }}">Projects</a></li>
    <li><a href="{{ url_for("project.project_view_page", project_name=project.name }}">
        {{ project.name }}
    </li>
    <li class="is-active"><a href="#" aria-current="page">Keys</a></li>
</ul>
{% endblock %}

{% block page_title %}{{ project.name }}{% endblock %}

{% block content %}
    <div class="content">
        <h2 class="is-size-4">Variable Keys</h2>
        <p>
            YAML files containing keys/value pairs are stored in the
            <span class="code">/project_data/{{ project.name }}/keys/</span>
            directory. The keys are used in the templates using the
            <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/" target="_blank" rel="noopener noreferrer">
                Jinja2 variable format
            </a>.
        </p>
        <p>
            Any YAML file in the <span class="code">/keys/</span> directory will be read into the
            configuration object and the values within will be available to use in the templates.
            The main key is the file name, so a file named <span class="code">mykeys.yaml</span>
            with the parameter <span class="code">myname: name</span> will be used in the template
            using <span class="code">{% raw %}{{ mykeys.myname }}{% endraw %}</span>.
        </p>
        {% for filename, values in keys.items() %}
            <h3 class="is-size-4">{{ filename }}</h3>
            <ul>
            {% macro render_dict(d) %}
                {% for key, value in d.items() %}
                    <li>
                        <strong>{{ key }}:</strong>
                        {% if value is mapping %}
                            <ul>
                                {{ render_dict(value) }}
                            </ul>
                        {% elif value is sequence and value is not string %}
                            <ul>
                                {% for item in value %}
                                    <li>{{ item }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            {{ value }}
                        {% endif %}
                    </li>
                {% endfor %}
            {% endmacro %}

            {{ render_dict(values) }}
            </ul>
        {% endfor %}
    </div>
{% endblock %}
